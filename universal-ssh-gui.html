<!DOCTYPE html>
<html>
<head>
    <title>Datacenter SSH Keys</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        input[type=text] { width: 400px; }
        button { margin-left: 10px; }
        .key { margin: 5px 0; }
        .key button { margin-left: 20px; }
    </style>
</head>
<body>
<h2>Datacenter SSH Keys</h2>
<label><input type="checkbox" id="toggle" checked> Enable universal keys</label><br><br>

<input type="text" id="newkey" placeholder="Paste SSH public key">
<button onclick="addKey()">Add Key</button>

<h3>Current Keys:</h3>
<div id="keylist"></div>

<script>
let keys = [];

function renderKeys() {
    const list = document.getElementById('keylist');
    list.innerHTML = '';
    keys.forEach((k,i) => {
        const div = document.createElement('div');
        div.className = 'key';
        div.textContent = k;
        const btn = document.createElement('button');
        btn.textContent = 'Remove';
        btn.onclick = () => { keys.splice(i,1); renderKeys(); applyKeys(); };
        div.appendChild(btn);
        list.appendChild(div);
    });
}

function addKey() {
    const key = document.getElementById('newkey').value.trim();
    if(key) {
        keys.push(key);
        document.getElementById('newkey').value = '';
        renderKeys();
        applyKeys();
    }
}

function applyKeys() {
    if(!document.getElementById('toggle').checked) return;

    fetch('/apply-keys',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({keys:keys})
    }).then(r=>r.text()).then(console.log);
}

renderKeys();
</script>
</body>
</html>
